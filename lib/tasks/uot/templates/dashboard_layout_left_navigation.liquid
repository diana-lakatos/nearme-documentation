<aside class="sidebar" role="complementary">
  <nav class="nav-primary">
    <div class="dashboard">
      <a href="{{ 'dashboard_company_transactable_type_transactables_path' | generate_url: platform_context.transactable_types.first.id }}">{{ 'dashboard.nav.title' | t }}</a>
    </div>

    <ul>
      {% comment %} Messages menu {% endcomment %}
      {% assign show = 'dashboard/user_messages' | is_visible %}
      {% if show %}
        {% assign path = 'dashboard_user_messages_path' | generate_url %}
        {% assign selected = current_path | matches: path %}

        <li id="dashboard-nav-user_messages" class="{% if selected %}selected{% endif %}">
          <a href="{{ path }}">
            {{ 'dashboard.nav.user_messages' | t }}
            {% if current_user.unread_messages_count > 0 %}
            <span class="count">{{ current_user.unread_messages_count }}</span>
            {% endif %}
          </a>
        </li>
      {% endif %}


      {% comment %} Reviews menu {% endcomment %}
      {% assign visible = 'dashboard/reviews' | is_visible %}
      {% assign show = platform_context.active_rating_systems_present? %}
      {% if show and visible %}
        {% assign reviews_rate_show = 'dashboard/reviews_rate' | is_visible %}
        {% assign reviews_rate_path = 'rate_dashboard_reviews_path' | generate_url %}
        {% assign reviews_rate_selected = current_path | matches: reviews_rate_path %}
        {% assign reviews_completed_show = 'dashboard/reviews_completed' | is_visible %}
        {% assign reviews_completed_path = 'completed_dashboard_reviews_path' | generate_url %}
        {% assign reviews_completed_selected = current_path | matches: reviews_completed_path %}

        <li id="dashboard-nav-reviews" class="{% if reviews_rate_selected or reviews_completed_selected %}selected{% endif %}">
          <span>{{ 'dashboard.nav.reviews' | t }}</span>
          <ul>
            {% if reviews_rate_show %}
              <li id="dashboard-nav-reviews_rate" class="{% if reviews_rate_selected %}selected{% endif %}">
                <a href="{{ reviews_rate_path }}">{{ 'dashboard.nav.reviews_rate' | t }}</a>
              </li>
            {% endif %}

            {% if reviews_completed_show %}
              <li id="dashboard-nav-reviews_completed" class="{% if reviews_completed_selected %}selected{% endif %}">
                <a href="{{ reviews_completed_path }}">{{ 'dashboard.nav.reviews_completed' | t }}</a>
              </li>
            {% endif %}
          </ul>
        </li>
      {% endif %}

      {% if platform_context.wish_lists_enabled? %}
        {% comment %} Favorites menu {% endcomment %}
        {% assign show = 'dashboard/wish_list_items' | is_visible %}
        {% if show %}
          {% assign path = 'dashboard_wish_list_items_path' | generate_url %}
          {% assign selected = current_path | matches: path %}
          <li id="dashboard-nav-wish_list_items" class="{% if selected %}selected{% endif %}">
            <a href="{{ path }}">{{ 'wish_lists.name' | t }}</a>
          </li>
        {% endif %}
      {% endif %}

      {% if platform_context.instance.action_rfq? %}
        {% comment %} User requests for quotes menu. {% endcomment %}
        {% assign path = 'dashboard_user_requests_for_quotes_path' | generate_url %}
        {% assign selected = current_path | matches: path %}
        <li id="dashboard-nav-my_rfq" class="{% if selected %}selected{% endif %}">
          <a href="{{ path }}">{{ 'dashboard.nav.my_rfq' | t }}</a>
        </li>
      {% endif %}

      {% comment %} Projects menu {% endcomment %}
      {% if platform_context.transactable_types.first.name %}
        {% assign projects_path = platform_context.project_space_wizard_path %}
        {% assign projects_selected = current_path | matches: path %}
        {% assign projects_visible = 'dashboard/projects' | is_visible %}
        {% if projects_visible %}
          {% assign projects_show = platform_context.projectable? %}
        {% endif %}
        {% assign transactables_path = 'dashboard_company_transactable_type_transactables_path' | generate_url: platform_context.transactable_types.first.id %}
        {% assign transactables_selected = current_path | matches: '/transactables(?!/new)' %}
        {% assign new_transactable_selected = current_path | matches: '/transactables/new' %}
        {% assign transactables_visible = 'dashboard/transactables' | is_visible %}
        {% if transactables_visible %}
          {% assign transactables_show = current_user.registration_completed? %}
        {% endif %}
        {% if current_user.buyer_profile == blank %}
          {% assign order_items_path = 'dashboard_company_order_items_path' | generate_url %}
        {% else %}
          {% assign order_items_path = 'dashboard_order_items_path' | generate_url %}
        {% endif %}
        {% assign order_items_selected = current_path | matches: 'dashboard/(company/)?(orders/[0-9]*/)?order_items' %}
        {% if projects_show %}
          <li id="dashboard-nav_projects_header" class="{% if projects_selected %}selected{% endif %}">
            <span>{{ 'dashboard.nav.projects_header' | t }}</span>
            <ul>
              <li id="dashboard-nav-projects" class="{% if projects_selected %}selected{% endif %}">
                <a href="{{ projects_path }}">{{ 'dashboard.nav.projects' | t }}</a>
              </li>
            </ul>
          </li>
        {% endif %}

        {% if transactables_show %}
          {% assign pending_transactables_count = current_user.pending_transactables_count %}
          <li id="dashboard-nav-transactables" class="{% if new_transactable_selected or transactables_selected or order_items_selected %}selected{% endif %}">
            <span>
                {{ 'dashboard.nav.transactables' | t }}
                {% if pending_transactables_count > 0 %}
                <span class="count">{{ pending_transactables_count }}</span>
                {% endif %}
            </span>

              <ul>
                {% if current_user.buyer_profile == blank %}
                  <li id="dashboard-nav-new_transactable" class="{% if new_transactable_selected %}selected{% endif %}">
                    <a href='{{ platform_context.transactable_types[0].new_transactable_path }}'>
                      Add a Project
                    </a>
                  </li>
                {% endif %}
                  <li id="dashboard-my-transactables" class="{% if transactables_selected %}selected{% endif %}">
                    <a href="{{ transactables_path }}">
                        {{ 'dashboard.nav.transactables' | t }}
                        {% if pending_transactables_count > 0 %}
                        <span class="count">{{ pending_transactables_count }}</span>
                        {% endif %}
                    </a>
                  </li>

                  <li id="dashboard-nav-order_items" class="{% if order_items_selected %}selected{% endif %}">
                    <a href="{{ order_items_path }}">{{ 'dashboard.nav.order_items' | t }}</a>
                  </li>
              </ul>
          </li>
        {% endif %}
      {% endif %}

      {% if current_user.registration_completed? %}
        {% assign payouts_show = 'dashboard/payouts' | is_visible %}
        {% assign payouts_path = 'edit_dashboard_company_payouts_path' | generate_url %}
        {% assign payouts_selected = current_path | matches: payouts_path %}
        {% assign transfers_show = 'dashboard/transfers' | is_visible %}
        {% assign transfers_path = 'dashboard_company_transfers_path' | generate_url %}
        {% assign transfers_selected = current_path | matches: transfers_path %}
        {% assign analytics_show = 'dashboard/analytics' | is_visible %}
        {% assign analytics_path = '/dashboard/company/analytics/expenses' %}
        {% assign analytics_selected = current_path | matches: analytics_path %}

        <li id="dashboard-nav-admin" class="{% if companies_selected or payouts_selected or transfers_selected or analytics_selected or users_selected or waiver_agreement_templates_selected or white_labels_selected or tickets_selected or sent_to_me_selected %}selected{% endif %}">
          <span>{{ 'dashboard.nav.admin' | t }}</span>

          <ul>
            {% if payouts_show and current_user.has_buyer_profile? %}
              <li id="dashboard-nav-payouts" class="{% if payouts_selected %}selected{% endif %}">
                <a href="{{ payouts_path }}">{{ 'dashboard.nav.payouts' | t }}</a>
              </li>
            {% endif %}

            {% if transfers_show and current_user.has_buyer_profile? %}
              <li id="dashboard-nav-transfers" class="{% if transfers_selected %}selected{% endif %}">
                <a href="{{ transfers_path }}">{{ 'dashboard.nav.transfers' | t }}</a>
              </li>
            {% endif %}

            {% if analytics_show and current_user.has_seller_profile? %}
              <li id="dashboard-nav-analytics" class="{% if analytics_selected %}selected{% endif %}">
                <a href="{{ analytics_path }}">{{ 'dashboard.nav.analytics' | t }}</a>
              </li>
            {% endif %}
          </ul>
        </li>
      {% endif %}

      {% comment %} Blog menu {% endcomment %}
      {% assign blog_menu_show = 'dashboard/blog' | is_visible %}

      {% if blog_menu_show %}
        {% assign blog_posts_path = 'dashboard_blog_path' | generate_url %}
        {% assign blog_posts_selected = current_path | matches: '/dashboard/blog(/posts)?(?!/edit)' %}
        {% assign blog_settings_path = 'edit_dashboard_blog_path' | generate_url %}
        {% assign blog_settings_selected = current_path | matches: '/dashboard/blog/edit' %}

        <li id="dashboard-nav-blog" class="{% if blog_settings_selected or blog_posts_selected %}selected{% endif %}">
          <span>{{ 'dashboard.nav.blog' | t }}</span>
          <ul>
            <li id="dashboard-nav-blog_posts" class="{% if blog_posts_selected %}selected{% endif %}">
              <a href="{{ blog_posts_path }}">{{ 'dashboard.nav.blog_posts' | t }}</a>
            </li>

            <li id="dashboard-nav-blog_settings" class="{% if blog_settings_selected %}selected{% endif %}">
              <a href="{{ blog_settings_path }}">{{ 'dashboard.nav.blog_settings' | t }}</a>
            </li>
          </ul>
        </li>
      {% endif %}

      {% comment %} Account menu {% endcomment %}
      {% assign profile_edit_selected = current_path | matches: '(users/edit|dashboard/seller/edit|dashboard/buyer/edit|dashboard/edit_profile)' %}
      {% assign credit_cards_selected = current_path | matches: '/dashboard/payment_gateways/[0-9]+/credit_card/' %}
      {% assign notification_preferences_show = 'dashboard/notification_preferences' | is_visible %}
      {% assign notification_preferences_path = 'edit_dashboard_notification_preferences_path' | generate_url %}
      {% assign notification_preferences_selected = current_path | matches: notification_preferences_path %}
      {% assign social_accounts_show = 'dashboard/social_accounts' | is_visible %}
      {% assign social_accounts_path = 'social_accounts_path' | generate_url %}
      {% assign social_accounts_selected = current_path | matches: social_accounts_path %}

      <li id="dashboard-nav-account" class="{% if profile_edit_selected or credit_cards_selected or notification_preferences_selected or social_accounts_selected %}selected{% endif %}">
        <span>{{ 'dashboard.nav.account' | t }}</span>
        <ul>
          <li id="dashboard-nav-edit" class="{% if profile_edit_selected %}selected{% endif %}">
            <a href="{{ 'dashboard_profile_path' | generate_url }}">{{ 'dashboard.nav.edit' | t }}</a>
          </li>
          {% if current_user.has_active_credit_cards? %}
            {% assign payment_gateway_id = '' | get_payment_gateway_id %}
            {% assign credit_cards_path = 'dashboard_payment_gateway_credit_cards_path' | generate_url: payment_gateway_id %}
            <li id="dashboard-nav-credit_cards" class="{% if credit_cards_selected %}selected{% endif %}">
              <a href="{{ credit_cards_path }}">{{ 'dashboard.nav.credit_cards' | t }}</a>
            </li>
          {% endif %}

          {% if notification_preferences_show %}
            <li id="dashboard-nav-notification_preferences" class="{% if notification_preferences_selected %}selected{% endif %}">
              <a href="{{ notification_preferences_path }}">{{ 'dashboard.nav.notification_preferences' | t }}</a>
            </li>
          {% endif %}

          {% if social_accounts_show %}
            <li id="dashboard-nav-social_accounts" class="{% if social_accounts_selected %}selected{% endif %}">
              <a href="{{ social_accounts_path }}">{{ 'dashboard.nav.social_accounts' | t }}</a>
            </li>
          {% endif %}
        </ul>
      </li>
    </ul>
  </nav>
</aside>
