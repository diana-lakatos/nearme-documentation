<div class="case-invite-content">
  <header>
    <h2>Invite to case</h2>
    <button type="button" data-close>Cancel</button>
  </header>

  {% assign collaborators = current_user | find_collaborators_for_user_transactables: user %}

  {% if collaborators.size > 0 %}
    <div class="existing-cases" data-delete-url="{{ 'dashboard_company_transactable_collaborators_path' | generate_url }}">
      <h3>{{ user.name }} is already invited to following cases:</h3>
      <ul>
        {% for collaborator in collaborators %}
        <li>
          {{ collaborator.transactable.name }}
          {% if collaborator.transactable.pending? %}
            <button type="button" class="button-b action-remove" data-transactable-collaborator-id="{{ collaborator.id }}" data-transactable-id="{{ collaborator.transactable.id }}">Remove</button>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% if user.pending_transactables.size > 0 %}


    {% if user.pending_collaborated_transactables.size == 0 %}
      <p><strong>{{ user.name }}</strong> will be invited to your case.</p>
      <p>Please select the case from the list below:</p>
    {% else %}
      <p>You have other cases, would you like to invite <strong>{{ user.name }}</strong> to another case? If so, please select from your case list below.</p>
    {% endif %}

    <form method="post" action="{{ 'dashboard_company_transactable_collaborators_path' | generate_url }}">
      <input type="hidden" name="transactable_collaborator[user_id]" value="{{ user.id }}">
      <input type="hidden" name="authenticity_token" value="{{ form_authenticity_token }}" />

      <div class="control-group">
        <label for="cases-list" class="control-label">My cases</label>
        <span class="select-a">
          <select id="cases-list" name="transactable_collaborator[transactable_id]" class="unstyled-select">
            {% for case in user.pending_transactables %}
            <option value="{{ case.id }}">{{ case.name }}</option>
            {% endfor %}
          </select>
        </span>
      </div>

      <div class="actions">
        <button type="submit" class="button-a">Invite</button>
      </div>
    </form>

  {% elsif current_user.has_pending_transactables? && user.pending_transactables.size == 0 %}

    <p>This user has been invited to all of your cases already.</p>

    <p>Would you like to add a new case now?</p>

    <div class="actions">
      <a href="{{ platform_context.transactable_types[0].new_transactable_path }}" class="button-a">Add a case</a>
      <button type="button" class="button-b" data-close>Cancel</button>
    </div>

  {% else %}

    <p>In order to invite a SME to a case, you must first create one.</p>

    <p>Would you like to add a case now?</p>

    <div class="actions">
      <a href="{{ platform_context.transactable_types[0].new_transactable_path }}" class="button-a">Add a case</a>
    </div>

  {% endif %}
</div>
